import{j as X,d as Y,u as Z,a as U,b as c,k as _,w as o,o as i,f as a,l as j,m as w,T as tt,c as $,n as V,t as A,F as I,q as T,s as nt,_ as et}from"./index-d85305d5.js";import{u as ot,a as k}from"./users-86cc464c.js";const at=X("groups",{state:()=>({groups:[]}),getters:{getGroupUsers_uuid:m=>d=>m.groups.find(C=>C.uuid==d).users_uuid,getTxByUuid:m=>d=>m.groups.find(C=>C.uuid==d).n_tx},actions:{setGroups(m){this.groups=m},setTxByUuid(m,d){let r=this.groups.findIndex(C=>C.uuid==m);this.groups[r].n_tx=d}}}),ut=Y({__name:"MainView",setup(m){const d=Z(),r=ot(),C=at();var g=U(!1);const h=U([]),s=U([]),D=t=>{s.value[t].ifJoin=!s.value[t].ifJoin},E=t=>{if(t==0)return;let n=s.value,e=n[t];n[t]=n[t-1],n[t-1]=e,s.value=n},M=t=>{if(t==s.value.length-1)return;let n=s.value[t];s.value[t]=s.value[t+1],s.value[t+1]=n},N=async()=>{g.value=!1,console.log(s.value),await k.add({uuids:s.value.filter(t=>t.ifJoin).map(t=>t.uuid)},x).then(function(t){d.success("创建成功"),b()}).catch(function(t){console.log(t)})},F=async t=>{await k.confirm({txuuid:h.value[t].txuuid},x).then(function(n){d.success("确认成功"),b()}).catch(function(n){console.log(n)})},q=async t=>{await k.getConfirmState({txuuid:h.value[t].txuuid},x).then(function(n){console.log(n.data),d.success(n.data.map(e=>r.searchAccount(e)).join(" ")),b()}).catch(function(n){console.log(n)})},L=async t=>{await k.cancel({txuuid:h.value[t].txuuid},x).then(function(n){d.success("取消成功"),b()}).catch(function(n){console.log(n)})},O=async t=>{await k.addTx({guuid:h.value[t].group_uuid},x).then(function(n){d.success("添加成功"),b()}).catch(function(n){console.log(n)})},x=r.getUUID,b=async()=>{await k.getUsers({},x).then(function(t){r.setOthers(t.data),s.value=t.data.filter(n=>n.uuid!=r.getUUID).map(n=>({text:n.account,uuid:n.uuid,ifJoin:!1}))}).catch(function(t){console.log(t)}),await k.getInfo({},x).then(function(t){t.data.forEach(e=>{e.data.sort((f,u)=>f.num-u.num)}),h.value=t.data.map(e=>({group_data:e.data.map(f=>({text:r.searchAccount(f.useruuid),icon:f.useruuid==e.next?"mdi-arrow-right-box":""})),group_uuid:e.guuid,txuuid:e.txuuid,next:e.next,confirm:!0}));let n=[];for(let e=0;e<t.data.length;e++){let f=t.data[e].guuid,u=[];for(let y=0;y<t.data[e].data.length;y++)u.push(t.data[e].data[y].useruuid);n.push({uuid:f,n_tx:t.data[e].txuuid,users_uuid:u})}C.setGroups(n)}).catch(function(t){console.log(t)}),await k.getConfirm({},x).then(function(t){console.log(t.data),t.data.forEach(n=>{let e=h.value.findIndex(f=>f.group_uuid==n.guuid);e!=-1&&(h.value[e].confirm=!1)})}).catch(function(t){console.log(t)})};return b(),(t,n)=>{const e=c("v-icon"),f=c("v-avatar"),u=c("v-btn"),y=c("v-app-bar"),R=c("v-card-title"),B=c("v-list-item-title"),J=c("v-list-item"),G=c("v-list"),z=c("v-card-text"),S=c("v-card"),H=c("v-dialog"),K=c("v-list-subheader"),P=c("v-container"),Q=c("v-main"),W=c("v-layout");return i(),_(W,null,{default:o(()=>[a(y,{color:"blue"},{prepend:o(()=>[a(f,{color:"info"},{default:o(()=>[a(e,{icon:"mdi-account-circle"})]),_:1})]),append:o(()=>[a(u,{variant:"tonal",onClick:n[0]||(n[0]=l=>j(g)?g.value=!0:g=!0)},{default:o(()=>[w(" Create ")]),_:1})]),_:1}),a(H,{modelValue:T(g),"onUpdate:modelValue":n[1]||(n[1]=l=>j(g)?g.value=l:g=l),width:"80%"},{default:o(()=>[a(S,null,{default:o(()=>[a(R,null,{default:o(()=>[w(" 创建新团体 "),a(u,{style:{float:"right"},variant:"tonal",onClick:N,color:"blue"},{default:o(()=>[w(" Comfirm ")]),_:1})]),_:1}),a(z,null,{default:o(()=>[a(G,null,{default:o(()=>[a(tt,{name:"list"},{default:o(()=>[(i(!0),$(I,null,V(s.value,(l,v)=>(i(),_(J,{key:l.text,color:"blue"},{append:o(()=>[l.ifJoin?(i(),_(u,{key:0,class:"sort-button",onClick:p=>D(v),icon:"mdi-checkbox-intermediate",color:"green"},null,8,["onClick"])):(i(),_(u,{key:1,class:"sort-button",onClick:p=>D(v),icon:"mdi-checkbox-blank-outline",color:"grey"},null,8,["onClick"])),a(u,{class:"sort-button",onClick:p=>E(v),icon:"mdi-arrow-up-bold",color:"blue"},null,8,["onClick"]),a(u,{class:"sort-button",onClick:p=>M(v),icon:"mdi-arrow-down-bold",color:"blue"},null,8,["onClick"])]),default:o(()=>[a(B,{textContent:A(l.text)},null,8,["textContent"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Q,null,{default:o(()=>[a(P,{fluid:"",class:"content-container"},{default:o(()=>[(i(!0),$(I,null,V(h.value,(l,v)=>(i(),_(S,{width:"90%",title:"三头野猪",subtitle:"没啥用的子标题"},{append:o(()=>[l.confirm?nt("",!0):(i(),_(u,{key:0,icon:"mdi-message-badge-outline",color:"red",onClick:p=>F(v)},null,8,["onClick"])),l.confirm?l.txuuid&&l.next==T(r).getUUID?(i(),_(u,{key:2,icon:"mdi mdi-help",color:"red",onClick:p=>q(v)},null,8,["onClick"])):!l.txuuid&&l.next==T(r).getUUID?(i(),_(u,{key:3,icon:"mdi mdi-check",color:"blue",onClick:p=>O(v)},null,8,["onClick"])):(i(),_(u,{key:4,disabled:"",icon:"mdi mdi-check",color:"green"})):(i(),_(u,{key:1,icon:"mdi mdi-close",color:"red",onClick:p=>L(v)},null,8,["onClick"]))]),default:o(()=>[a(G,{density:"compact"},{default:o(()=>[a(K,null,{default:o(()=>[w("成员列表")]),_:1}),(i(!0),$(I,null,V(l.group_data,(p,lt)=>(i(),_(J,{color:"blue"},{prepend:o(()=>[a(e,{icon:p.icon,color:"red"},null,8,["icon"])]),default:o(()=>[a(B,{textContent:A(p.text)},null,8,["textContent"])]),_:2},1024))),256))]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})}}});const st=et(ut,[["__scopeId","data-v-45f7371c"]]);export{st as default};
